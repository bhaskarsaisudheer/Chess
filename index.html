<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Chess Game</title>
  <style>
:root{--board-size:min(90vmin,700px);--light:#f0d9b5;--dark:#b58863;--accent:#4f46e5;--danger:#ef4444}
html,body{height:100%}
body{margin:0;font-family:ui-sans-serif,system-ui,Arial;background:#f8fafc;display:grid;place-items:center;padding:20px}
.wrap{display:flex;flex-direction:column;align-items:center;gap:15px}
h1{margin:0;font-size:1.6rem;font-weight:700}
.topbar{display:flex;justify-content:space-between;align-items:center;width:100%;max-width:700px}
.status{display:flex;gap:12px}
.pill{padding:6px 10px;border-radius:999px;background:#eef2ff;border:1px solid #e0e7ff;font-size:.9rem}
.turn{display:flex;align-items:center;gap:6px}
.dot{width:10px;height:10px;border-radius:50%;background:#000}
.dot.white{background:#fff;border:3px solid #000}
.dot.black{background:#000}
.board{width:var(--board-size);display:grid;grid-template-columns:repeat(8,1fr);grid-template-rows:repeat(8,1fr);border-radius:12px;overflow:hidden;box-shadow:0 8px 20px rgba(0,0,0,.2)}
.sq{aspect-ratio:1/1;display:grid;place-items:center;font-size:calc(var(--board-size)/9);cursor:pointer;user-select:none}
.light{background:var(--light)}
.dark{background:var(--dark)}
.sel{outline:3px solid var(--accent);outline-offset:-3px}
.move::after{content:"";width:28%;height:28%;border-radius:50%;background:rgba(79,70,229,.4)}
.capture::after{content:"";position:absolute;inset:12%;border:4px solid var(--danger);border-radius:10px}
.lastmove{box-shadow:inset 0 0 0 4px rgba(253,230,138,.8)}
.controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
button{border:none;background:#111827;color:#fff;padding:8px 12px;border-radius:8px;font-weight:600;cursor:pointer}
button.secondary{background:#4f46e5}
button.ghost{background:#f1f5f9;color:#111827}
button:disabled{opacity:.5;cursor:not-allowed}
select{padding:6px 10px;border-radius:8px;border:1px solid #cbd5e1}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <h1>♟️ Chess</h1>
      <div class="status">
        <span class="pill turn"><span class="dot" id="turn-dot"></span><span id="turn-text">White to move</span></span>
        <span id="state-pill" class="pill">Ready</span>
      </div>
    </div>
    <div id="board" class="board"></div>
    <div class="controls">
      <button id="newgame">New</button>
      <button id="undo" class="ghost" disabled>Undo</button>
      <button id="flip" class="secondary">Flip</button>
      <select id="mode"><option value="pvp">1 vs 1</option><option value="ai">Vs Computer</option></select>
    </div>
  </div>
  <script>
const boardEl=document.getElementById("board"),turnText=document.getElementById("turn-text"),turnDot=document.getElementById("turn-dot"),undoBtn=document.getElementById("undo"),flipBtn=document.getElementById("flip"),newBtn=document.getElementById("newgame"),modeSel=document.getElementById("mode");
let board,turn,history=[],flipped=false,mode="pvp",selected=null,legalMoves=[],lastMove=null;
const PIECES={P:"♙",R:"♖",N:"♘",B:"♗",Q:"♕",K:"♔",p:"♟",r:"♜",n:"♞",b:"♝",q:"♛",k:"♚"};
function init(){board=[["r","n","b","q","k","b","n","r"],["p","p","p","p","p","p","p","p"],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["P","P","P","P","P","P","P","P"],["R","N","B","Q","K","B","N","R"]];turn="w";history=[];selected=null;legalMoves=[];lastMove=null;render();updateStatus()}
function render(){boardEl.innerHTML="";for(let r=0;r<8;r++)for(let c=0;c<8;c++){const sq=document.createElement("div");sq.className="sq "+((r+c)%2?"dark":"light");sq.dataset.row=r;sq.dataset.col=c;if(board[r][c])sq.textContent=PIECES[board[r][c]];if(selected&&selected[0]==r&&selected[1]==c)sq.classList.add("sel");if(lastMove&&(lastMove.from[0]==r&&lastMove.from[1]==c||lastMove.to[0]==r&&lastMove.to[1]==c))sq.classList.add("lastmove");for(let m of legalMoves)if(m[0]==r&&m[1]==c)sq.classList.add(board[r][c]?"capture":"move");sq.addEventListener("click",()=>handleClick(r,c));boardEl.appendChild(sq)}}
function updateStatus(){turnText.textContent=turn=="w"?"White to move":"Black to move";turnDot.className="dot "+(turn=="w"?"white":"black");undoBtn.disabled=history.length==0}
function handleClick(r,c){if(selected){if(r==selected[0]&&c==selected[1]){selected=null;legalMoves=[];render();return}for(let m of legalMoves)if(m[0]==r&&m[1]==c){makeMove(selected,[r,c]);return}selected=null;legalMoves=[];render()}else{if(board[r][c]&&(turn=="w"&&/[PRNBQK]/.test(board[r][c])||turn=="b"&&/[prnbqk]/.test(board[r][c]))){selected=[r,c];legalMoves=getMoves(r,c);render()}}}
function makeMove(from,to){const piece=board[from[0]][from[1]];history.push(JSON.stringify({board,turn,lastMove}));board=board.map(r=>r.slice());board[to[0]][to[1]]=piece;board[from[0]][from[1]]="";lastMove={from,to,piece};selected=null;legalMoves=[];turn=turn=="w"?"b":"w";render();updateStatus();if(mode=="ai"&&turn=="b")setTimeout(aiMove,400)}
function getMoves(r,c){const moves=[],piece=board[r][c];if(!piece)return[];const dirs={N:[-1,0],S:[1,0],E:[0,1],W:[0,-1],NE:[-1,1],NW:[-1,-1],SE:[1,1],SW:[1,-1]};const add=(dr,dc,m)=>{let nr=r+dr,nc=c+dc;if(nr>=0&&nr<8&&nc>=0&&nc<8){if(!board[nr][nc]||isOpp(board[nr][nc]))m.push([nr,nc])}};if(piece=="P"){if(r>0&&!board[r-1][c])moves.push([r-1,c]);if(r==6&&!board[5][c]&&!board[4][c])moves.push([4,c]);if(r>0&&c>0&&/[prnbqk]/.test(board[r-1][c-1]))moves.push([r-1,c-1]);if(r>0&&c<7&&/[prnbqk]/.test(board[r-1][c+1]))moves.push([r-1,c+1])}else if(piece=="p"){if(r<7&&!board[r+1][c])moves.push([r+1,c]);if(r==1&&!board[2][c]&&!board[3][c])moves.push([3,c]);if(r<7&&c>0&&/[PRNBQK]/.test(board[r+1][c-1]))moves.push([r+1,c-1]);if(r<7&&c<7&&/[PRNBQK]/.test(board[r+1][c+1]))moves.push([r+1,c+1])}else if(piece.toLowerCase()=="r"){for(let d of["N","S","E","W"])for(let i=1;;i++){let nr=r+i*dirs[d][0],nc=c+i*dirs[d][1];if(nr<0||nr>7||nc<0||nc>7)break;if(!board[nr][nc])moves.push([nr,nc]);else{if(isOpp(board[nr][nc]))moves.push([nr,nc]);break}}}else if(piece.toLowerCase()=="b"){for(let d of["NE","NW","SE","SW"])for(let i=1;;i++){let nr=r+i*dirs[d][0],nc=c+i*dirs[d][1];if(nr<0||nr>7||nc<0||nc>7)break;if(!board[nr][nc])moves.push([nr,nc]);else{if(isOpp(board[nr][nc]))moves.push([nr,nc]);break}}}else if(piece.toLowerCase()=="q"){for(let d of["N","S","E","W","NE","NW","SE","SW"])for(let i=1;;i++){let nr=r+i*dirs[d][0],nc=c+i*dirs[d][1];if(nr<0||nr>7||nc<0||nc>7)break;if(!board[nr][nc])moves.push([nr,nc]);else{if(isOpp(board[nr][nc]))moves.push([nr,nc]);break}}}else if(piece.toLowerCase()=="n"){for(let[dr,dc]of[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]]){let nr=r+dr,nc=c+dc;if(nr>=0&&nr<8&&nc>=0&&nc<8&&(!board[nr][nc]||isOpp(board[nr][nc])))moves.push([nr,nc])}}else if(piece.toLowerCase()=="k"){for(let d of["N","S","E","W","NE","NW","SE","SW"]){let nr=r+dirs[d][0],nc=c+dirs[d][1];if(nr>=0&&nr<8&&nc>=0&&nc<8&&(!board[nr][nc]||isOpp(board[nr][nc])))moves.push([nr,nc])}}return moves;function isOpp(p){return turn=="w"?/[prnbqk]/.test(p):/[PRNBQK]/.test(p)}}
function aiMove(){let moves=[];for(let r=0;r<8;r++)for(let c=0;c<8;c++)if(/[prnbqk]/.test(board[r][c])){let ms=getMoves(r,c);for(let m of ms)moves.push({from:[r,c],to:m})}if(moves.length){let m=moves[Math.floor(Math.random()*moves.length)];makeMove(m.from,m.to)}}
newBtn.onclick=()=>init();undoBtn.onclick=()=>{if(history.length){let prev=JSON.parse(history.pop());board=prev.board;turn=prev.turn;lastMove=prev.lastMove;render();updateStatus()}};flipBtn.onclick=()=>{flipped=!flipped;board.reverse().forEach(r=>r.reverse());render()};modeSel.onchange=e=>{mode=e.target.value};init();
  </script>
</body>
</html>
